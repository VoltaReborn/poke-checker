<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pok√©Type Checker</title>
<link rel="manifest" href="manifest.json">
<style>
:root {
  --bg:#0a1224;
  --card:#15254b;
  --accent:#ffb400;
  --text:#fff;
}
body { margin:0; font-family:system-ui,Arial,sans-serif; background:var(--bg); color:var(--text); }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 16px; background:var(--card); }
h1 { font-size:1.1rem; margin:0; }

/* ---------- TABS ---------- */
#modeTabs { display:flex; justify-content:center; margin:10px 0; }
.tab {
  padding:8px 16px; background:var(--card); color:var(--text);
  border:1px solid var(--accent); border-radius:8px; margin:0 5px; cursor:pointer;
}
.tab.active { background:var(--accent); color:#000; }

/* ---------- SECTIONS ---------- */
.section { display:none; padding:10px; }
.section.active { display:block; }
.resultCard {
  background:var(--card); margin:8px 0; padding:10px;
  border:1px solid var(--accent); border-radius:8px; animation:fade .3s;
}
@keyframes fade { from{opacity:0;} to{opacity:1;} }
.type-badge { display:inline-block; border-radius:12px; padding:4px 8px; margin:2px; color:#fff; font-weight:600; font-size:.9rem; }

/* ---------- CONTROLS LAYOUT ---------- */
#typeControls, #pokeControls { display:flex; flex-direction:column; align-items:center; gap:10px; margin-bottom:10px; }
select, input {
  width:90%; max-width:320px; font-size:1rem; padding:10px; border-radius:6px;
  border:1px solid var(--accent); background:var(--card); color:var(--text); text-align:center;
}
select:focus, input:focus { outline:none; box-shadow:0 0 4px var(--accent); }
#typeButtons, #pokeButtons { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }

/* ---------- BUTTONS ---------- */
button { font-size:1rem; padding:8px 12px; border-radius:6px; border:1px solid var(--accent); background:var(--card); color:var(--text); cursor:pointer; }
button:hover { background:var(--accent); color:#000; }
#resetBtn, #pokeResetBtn { background:none; border:1px solid var(--accent); color:var(--accent); }
#resetBtn:hover, #pokeResetBtn:hover { background:var(--accent); color:#000; }

/* ---------- DIVIDER ---------- */
.section-divider {
  margin:16px 0; text-align:center; font-weight:bold; color:var(--accent); position:relative;
}
.section-divider::before, .section-divider::after {
  content:""; position:absolute; top:50%; width:40%; height:1px;
  background:linear-gradient(to right,transparent,var(--accent),transparent);
}
.section-divider::before { left:0; } .section-divider::after { right:0; }

/* ---------- TYPE PREVIEW ---------- */
#typePreview, #pokeTypePreview { display:flex; justify-content:center; gap:6px; }
.type-preview-badge { display:inline-block; width:60px; height:18px; border-radius:10px; }

/* ---------- POK√âMON CHECKER ---------- */
#pokeImg { width:120px; display:block; margin:10px auto; }
#pokeList div { padding:4px 8px; background:var(--card); border:1px solid var(--accent); border-radius:6px; margin:2px 0; }
#pokeList div:hover { background:var(--accent); color:#000; }

/* ---------- THEME TOGGLE ---------- */
#themeToggle { background:none; border:none; cursor:pointer; color:var(--accent); font-size:1.2rem; }

/* ---------- RESPONSIVE ---------- */
@media(min-width:700px){
  main { display:grid; grid-template-columns:1fr 1fr; gap:12px; padding:10px; }
}
</style>
</head>
<body>
<header>
  <h1>Pok√©Type Checker</h1>
  <button id="themeToggle">üé®</button>
</header>

<div id="modeTabs">
  <div class="tab active" data-target="typeSection">Type Checker</div>
  <div class="tab" data-target="pokeSection">Pok√©mon Checker</div>
</div>

<main>
  <!-- TYPE SECTION -->
  <section id="typeSection" class="section active">
    <div id="typeControls">
      <label>Type 1:
        <select id="type1"></select>
      </label>
      <label>Type 2:
        <select id="type2"><option value="">(none)</option></select>
      </label>
      <div id="typePreview"></div>
    </div>
    <div id="typeButtons">
      <button id="checkBtn">Check Effectiveness</button>
      <button id="resetBtn">Reset Types</button>
    </div>
    <div id="typeResults"></div>
  </section>

  <!-- POK√âMON SECTION -->
  <section id="pokeSection" class="section">
    <div id="pokeControls">
      <input id="pokeSearch" placeholder="Search Pok√©mon name..." autocomplete="off" />
      <div id="pokeList"></div>
      <img id="pokeImg" hidden>
      <div id="pokeTypes"></div>
      <div id="pokeTypePreview"></div>
    </div>
    <div id="pokeButtons">
      <button id="pokeResetBtn">Reset Pok√©mon</button>
    </div>
    <div id="pokeResults"></div>
  </section>
</main>

<script>
/* ---------- VERSION CONTROL (optional UI button) ---------- */
const appVersion = "1.2.1";
const refreshButton = document.createElement("button");
refreshButton.textContent = "üîÑ Refresh App";
Object.assign(refreshButton.style, { position:"fixed", bottom:"10px", right:"10px", padding:"6px 10px",
  fontSize:"0.9rem", borderRadius:"6px", border:"1px solid var(--accent)", background:"var(--card)", color:"var(--accent)", zIndex:"9999"});
refreshButton.onclick = () => {
  localStorage.removeItem("poketype-version");
  if ('caches' in window) caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
  location.reload(true);
};
document.addEventListener("DOMContentLoaded", () => document.body.append(refreshButton));
const storedVersion = localStorage.getItem("poketype-version");
if (storedVersion && storedVersion !== appVersion) {
  if ('caches' in window) caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
  localStorage.setItem("poketype-version", appVersion);
  location.reload(true);
} else if (!storedVersion) {
  localStorage.setItem("poketype-version", appVersion);
}

/* ---------- TYPE DATA ---------- */
const typeChart={
Normal:{weak:["Fighting"],resist:[],immune:["Ghost"]},
Fire:{weak:["Water","Ground","Rock"],resist:["Fire","Grass","Ice","Bug","Steel","Fairy"],immune:[]},
Water:{weak:["Electric","Grass"],resist:["Fire","Water","Ice","Steel"],immune:[]},
Electric:{weak:["Ground"],resist:["Electric","Flying","Steel"],immune:[]},
Grass:{weak:["Fire","Ice","Poison","Flying","Bug"],resist:["Water","Electric","Grass","Ground"],immune:[]},
Ice:{weak:["Fire","Fighting","Rock","Steel"],resist:["Ice"],immune:[]},
Fighting:{weak:["Flying","Psychic","Fairy"],resist:["Bug","Rock","Dark"],immune:[]},
Poison:{weak:["Ground","Psychic"],resist:["Grass","Fighting","Poison","Bug","Fairy"],immune:[]},
Ground:{weak:["Water","Grass","Ice"],resist:["Poison","Rock"],immune:["Electric"]},
Flying:{weak:["Electric","Ice","Rock"],resist:["Grass","Fighting","Bug"],immune:["Ground"]},
Psychic:{weak:["Bug","Ghost","Dark"],resist:["Fighting","Psychic"],immune:[]},
Bug:{weak:["Fire","Flying","Rock"],resist:["Grass","Fighting","Ground"],immune:[]},
Rock:{weak:["Water","Grass","Fighting","Ground","Steel"],resist:["Normal","Fire","Poison","Flying"],immune:[]},
Ghost:{weak:["Ghost","Dark"],resist:["Poison","Bug"],immune:["Normal","Fighting"]},
Dragon:{weak:["Ice","Dragon","Fairy"],resist:["Fire","Water","Electric","Grass"],immune:[]},
Dark:{weak:["Fighting","Bug","Fairy"],resist:["Ghost","Dark"],immune:["Psychic"]},
Steel:{weak:["Fire","Fighting","Ground"],resist:["Normal","Grass","Ice","Flying","Psychic","Bug","Rock","Dragon","Steel","Fairy"],immune:["Poison"]},
Fairy:{weak:["Poison","Steel"],resist:["Fighting","Bug","Dark"],immune:["Dragon"]}
};
const typeColors={Normal:"#A8A77A",Fire:"#EE8130",Water:"#6390F0",Electric:"#F7D02C",Grass:"#7AC74C",
Ice:"#96D9D6",Fighting:"#C22E28",Poison:"#A33EA1",Ground:"#E2BF65",Flying:"#A98FF3",
Psychic:"#F95587",Bug:"#A6B91A",Rock:"#B6A136",Ghost:"#735797",Dragon:"#6F35FC",
Dark:"#705746",Steel:"#B7B7CE",Fairy:"#D685AD"};
const types=Object.keys(typeChart);
const t1=document.getElementById("type1"),t2=document.getElementById("type2");

/* ---------- COLORFUL OPTIONS (desktop-capable) ---------- */
function addTypeOptions(sel){
  types.forEach(t=>{
    const opt=new Option(t,t);
    opt.style.background=typeColors[t];
    opt.style.color="#fff";
    opt.style.fontWeight="600";
    sel.add(opt);
  });
}
addTypeOptions(t1); addTypeOptions(t2);

/* ---------- TAB SWITCH ---------- */
document.querySelectorAll(".tab").forEach(tab=>{
  tab.onclick=()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.target).classList.add("active");
  };
});

/* ---------- THEME TOGGLE ---------- */
let pokemonTheme=false;
document.getElementById("themeToggle").onclick=()=>{
  pokemonTheme=!pokemonTheme;
  document.documentElement.style.setProperty("--bg",pokemonTheme?"#fff":"#0a1224");
  document.documentElement.style.setProperty("--card",pokemonTheme?"#f4f4f4":"#15254b");
  document.documentElement.style.setProperty("--text",pokemonTheme?"#000":"#fff");
};

/* ---------- PREVIEW BADGES ---------- */
function updateTypePreview(){
  const preview=document.getElementById("typePreview");
  preview.innerHTML="";
  [t1.value,t2.value].filter(Boolean).forEach(t=>{
    const div=document.createElement("div");
    div.className="type-preview-badge";
    div.style.background=typeColors[t];
    preview.append(div);
  });
}
t1.onchange=updateTypePreview; t2.onchange=updateTypePreview;

/* ---------- RESET BUTTON ---------- */
document.getElementById("resetBtn").onclick=()=>{
  t1.selectedIndex=0; t2.selectedIndex=0;
  document.getElementById("typeResults").innerHTML="";
  updateTypePreview();
};

/* ---------- EFFECTIVENESS CALCS ---------- */
function calcOffense(selTypes){
  const all=Object.keys(typeChart); const result={strong:[],weak:[],immune:[]};
  all.forEach(def=>{
    let mult=1;
    selTypes.forEach(atk=>{
      if(typeChart[def].weak.includes(atk)) mult*=2;
      if(typeChart[def].resist.includes(atk)) mult*=0.5;
      if(typeChart[def].immune.includes(atk)) mult*=0;
    });
    if(mult>1) result.strong.push({type:def,mult});
    if(mult<1&&mult>0) result.weak.push({type:def,mult});
    if(mult===0) result.immune.push({type:def,mult});
  });
  return result;
}
function calcDefense(selTypes){
  const all=Object.keys(typeChart); const result={strong:[],weak:[],immune:[]};
  all.forEach(atk=>{
    let mult=1;
    selTypes.forEach(def=>{
      if(typeChart[def].weak.includes(atk)) mult*=2;
      if(typeChart[def].resist.includes(atk)) mult*=0.5;
      if(typeChart[def].immune.includes(atk)) mult*=0;
    });
    if(mult>1) result.strong.push({type:atk,mult});
    if(mult<1&&mult>0) result.weak.push({type:atk,mult});
    if(mult===0) result.immune.push({type:atk,mult});
  });
  return result;
}

/* ---------- RENDERERS ---------- */
function renderBoth(container,label,defense,offense){
  container.innerHTML="";
  const make=(l,d)=>{
    if(!d.length) return "";
    let html=`<div class='resultCard'><strong>${l}</strong><br>`;
    d.forEach(o=>{ html+=`<span class='type-badge' style='background:${typeColors[o.type]}'>${o.type} √ó${o.mult}</span>`; });
    return html+"</div>";
  };
  container.innerHTML+=make(`Strong Against ${label}`,defense.strong);
  container.innerHTML+=make(`Not Very Effective Against ${label}`,defense.weak);
  container.innerHTML+=make(`No Effect Against ${label}`,defense.immune);
  container.innerHTML+=`<div class='section-divider'>Counter Perspective ‚ñº</div>`;
  container.innerHTML+=make(`${label} is Strong Against`,offense.strong);
  container.innerHTML+=make(`${label} is Weak Against`,offense.weak);
  container.innerHTML+=make(`${label} has No Effect On`,offense.immune);
}
function renderDefenseOnly(container,label,defense){
  container.innerHTML="";
  const make=(l,d)=>{
    if(!d.length) return "";
    let html=`<div class='resultCard'><strong>${l}</strong><br>`;
    d.forEach(o=>{ html+=`<span class='type-badge' style='background:${typeColors[o.type]}'>${o.type} √ó${o.mult}</span>`; });
    return html+"</div>";
  };
  container.innerHTML+=make(`Strong Against ${label}`,defense.strong);
  container.innerHTML+=make(`Not Very Effective Against ${label}`,defense.weak);
  container.innerHTML+=make(`No Effect Against ${label}`,defense.immune);
}

/* ---------- TYPE CHECK BUTTON ---------- */
document.getElementById("checkBtn").onclick=()=>{
  const sel=[t1.value,t2.value].filter(Boolean);
  if(!sel.length) return;
  const label=sel.join(" / ");
  const def=calcDefense(sel), off=calcOffense(sel);
  renderBoth(document.getElementById("typeResults"),label,def,off);
};

/* ---------- POK√âMON CHECKER ---------- */
const pokeInput=document.getElementById("pokeSearch"),
      pokeList=document.getElementById("pokeList");
let pokedata=[];
async function loadData(){
  if(pokedata.length) return;
  const res=await fetch("https://raw.githubusercontent.com/fanzeyi/pokemon.json/master/pokedex.json");
  const list=await res.json();
  pokedata=list.map(p=>({name:p.name.english,types:p.type,id:p.id}));
}
pokeInput.addEventListener("input",async()=>{
  await loadData();
  const q=pokeInput.value.toLowerCase();
  pokeList.innerHTML="";
  if(!q) return;
  pokedata.filter(p=>p.name.toLowerCase().includes(q)).slice(0,10).forEach(p=>{
    const div=document.createElement("div");
    div.textContent=p.name; div.style.cursor="pointer";
    div.onclick=()=>selectPoke(p);
    pokeList.append(div);
  });
});
async function selectPoke(p){
  pokeList.innerHTML=""; pokeInput.value=p.name;
  document.getElementById("pokeTypes").innerHTML="";
  const img=document.getElementById("pokeImg");
  const num=String(p.id).padStart(3,"0");
  img.src=`https://raw.githubusercontent.com/fanzeyi/pokemon.json/master/images/${num}.png`;
  img.hidden=false;
  p.types.forEach(t=>{
    const b=document.createElement("span");
    b.className="type-badge"; b.textContent=t; b.style.background=typeColors[t];
    document.getElementById("pokeTypes").append(b);
  });
  const def=calcDefense(p.types);
  renderDefenseOnly(document.getElementById("pokeResults"),p.name,def);

  // sync Type tab with Pok√©mon types and pre-render both views
  t1.value=p.types[0]; t2.value=p.types[1]||""; updateTypePreview();
  const label=p.types.join(" / "); const off=calcOffense(p.types);
  renderBoth(document.getElementById("typeResults"),label,def,off);
}

/* ---------- POK√âMON RESET ---------- */
document.getElementById("pokeResetBtn").onclick=()=>{
  pokeInput.value=""; document.getElementById("pokeList").innerHTML="";
  document.getElementById("pokeTypes").innerHTML=""; document.getElementById("pokeResults").innerHTML="";
  document.getElementById("pokeImg").hidden=true;
};

/* ---------- PWA REGISTRATION (only over http/https) ---------- */
if("serviceWorker" in navigator && location.protocol.startsWith("http")){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
